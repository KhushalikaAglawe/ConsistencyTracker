<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consistency Graph</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

:root{
  --pink-main:#ec4899;
  --pink-dark:#be185d;
  --pink-soft:#fbcfe8;
  --pink-light:#fdf2f8;
  --text-main:#3f3f46;
}

body{
  font-family:'Poppins',sans-serif;
  min-height:100vh;
  background:
    radial-gradient(900px 500px at 10% 0%, rgba(236,72,153,0.25), transparent 60%),
    radial-gradient(700px 400px at 90% 90%, rgba(251,207,232,0.35), transparent 60%),
    var(--pink-light);
  color:var(--text-main);
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 32px;
  background:rgba(255,255,255,0.65);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--pink-soft);
  position:sticky;
  top:0;
  z-index:10;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
}

.logo{
  width:36px;
  height:36px;
  border-radius:10px;
  background:linear-gradient(135deg,var(--pink-main),#f472b6);
  transform:rotate(45deg);
}

.brand h1{
  font-size:22px;
  font-weight:700;
  color:var(--pink-dark);
}

/* NAV */
nav button{
  margin-left:12px;
  padding:8px 18px;
  border-radius:22px;
  border:none;
  background:transparent;
  font-weight:600;
  cursor:pointer;
  color:var(--pink-dark);
}

nav button:hover{
  background:var(--pink-soft);
}

/* WRAPPER */
.wrapper{
  max-width:1200px;
  margin:40px auto;
  padding:0 20px;
}

.header-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

h2{
  font-size:26px;
  font-weight:700;
  color:var(--pink-dark);
}

/* YEAR SELECT */
select{
  padding:8px 14px;
  border-radius:14px;
  border:1px solid var(--pink-soft);
  background:white;
  font-weight:600;
  color:var(--pink-dark);
  cursor:pointer;
}

/* GRAPH */
.graph-wrapper{
  padding:20px;
  background:linear-gradient(to bottom right, rgba(255,240,246,0.95), rgba(255,220,235,0.9));
  border-radius:20px;
  box-shadow:0 12px 30px rgba(236,72,153,0.18);
  overflow-x:auto;
}

.graph{
  display:flex;
  gap:22px;
}

.month{
  display:grid;
  grid-template-columns:repeat(7,14px);
  grid-auto-rows:14px;
  gap:4px;
}

.day{
  width:14px;
  height:14px;
  border-radius:4px;
}

.l0{background:#e0e0e0;}
.l1{background:#ffb3d9;}
.l2{background:#ff80c2;}
.l3{background:#ff4db3;}
.l4{background:#e60099;}

.label{
  text-align:center;
  font-size:12px;
  margin-bottom:6px;
  font-weight:600;
  color:var(--pink-dark);
}
</style>
</head>

<body>

<header>
  <div class="brand">
    <div class="logo"></div>
    <h1>Consistency</h1>
  </div>
  <nav>
    <button onclick="location.href='index.html'">Home</button>
    <button onclick="location.href='tasks.html'">Tasks</button>
    <button onclick="location.href='graph.html'">Graph</button>
    <button onclick="location.href='balance.html'">Balance</button>
  </nav>
</header>

<div class="wrapper">

  <div class="header-row">
    <h2>Yearly Consistency</h2>
    <select id="yearSelect"></select>
  </div>

  <div class="graph-wrapper">
    <div class="graph" id="graph"></div>
  </div>

</div>

<script>
const graph = document.getElementById('graph');
const yearSelect = document.getElementById('yearSelect');
const TOTAL_TASKS = 20;

// stored as { "2025-01-01": [true,false...] }
const allData = JSON.parse(localStorage.getItem('yearTasks')) || {};

// Extract unique years
const years = [...new Set(Object.keys(allData).map(d => d.split('-')[0]))];
const currentYear = new Date().getFullYear().toString();

if(!years.includes(currentYear)) years.push(currentYear);

years.sort().forEach(y=>{
  const opt = document.createElement('option');
  opt.value = y;
  opt.textContent = y;
  yearSelect.appendChild(opt);
});

yearSelect.value = currentYear;

function getLevel(done){
  if(done===0) return 'l0';
  if(done<=5) return 'l1';
  if(done<=10) return 'l2';
  if(done<=15) return 'l3';
  return 'l4';
}

function renderGraph(year){
  graph.innerHTML = '';

  for(let m=0;m<12;m++){
    const monthDiv = document.createElement('div');

    const label = document.createElement('div');
    label.className='label';
    label.textContent=new Date(year,m).toLocaleString('default',{month:'short'});

    const grid = document.createElement('div');
    grid.className='month';

    const days = new Date(year,m+1,0).getDate();

    for(let d=1;d<=days;d++){
      const date=`${year}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const state=allData[date]||[];
      const done=state.filter(Boolean).length;

      const cell=document.createElement('div');
      cell.className=`day ${getLevel(done)}`;
      grid.appendChild(cell);
    }

    monthDiv.appendChild(label);
    monthDiv.appendChild(grid);
    graph.appendChild(monthDiv);
  }
}

yearSelect.addEventListener('change',()=>{
  renderGraph(yearSelect.value);
});

// Initial render
renderGraph(currentYear);
</script>

</body>
</html>
